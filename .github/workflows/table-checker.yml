name: 检查表格是否正确

on:
    workflow_dispatch:
    push:
      branches:
        - main
        - Account
      paths:
        - 'Search-table.md'
    pull_request:
      paths:
        - 'Search-table.md'

jobs:
  check-table:
    runs-on: ubuntu-latest

    steps:
    - name: 检出代码
      uses: actions/checkout@v3

    - name: 设置 Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: 运行检查
      id: table-check
      run: |
        node .action_scripts/table-checker.js
        echo "result=$?" >> $GITHUB_ENV

    - name: 设置标签
      if: github.event_name == 'pull_request'
      run: |
        result=$(echo ${{ env.result }})
        labelsToAdd=()

        if [ "$result" -eq 0 ]; then
          labelsToAdd+=('检查：通过')
        elif [ "$result" -eq 1 ] || [ "$result" -eq 3 ]; then
          labelsToAdd+=('检查：异常')
        fi
        if [ "$result" -eq 2 ]; then
          labelsToAdd+=('检查：重复')
        fi
        if [ "$result" -eq 1 ] || [ "$result" -eq 2 ] || [ "$result" -eq 3 ]; then
          labelsToAdd+=('需要提交者确认')
        fi

        for label in "${labelsToAdd[@]}"; do
          gh issue edit ${{ github.event.issue.number }} --add-label "$label"
        done
